server {
  server_tokens off;
  listen 80;
{% if ipv6 == true %}  listen [::]:80;{% endif %}

  server_name {{ dn_from }};
  return {{ redirect_code }} https://{{ dn_to }}:443{{ path_to }};
}

{% if tls == true %}
server {
  server_tokens off;
  listen 443 ssl http2;
{% if ipv6 == true %}  listen [::]:443 ssl http2;{% endif %}

  server_name {{ dn_from }};
  ssl_certificate      /etc/letsencrypt/live/{{ dn_from }}/fullchain.pem;
  ssl_certificate_key  /etc/letsencrypt/live/{{ dn_from }}/privkey.pem;
  include /etc/nginx/includes/options-ssl.conf;

  ssl_dhparam /etc/nginx/dhparam/dhparam.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/{{ dn_from }}/chain.pem;

  return {{ redirect_code }} https://{{ dn_to }}:443{{ path_to }};
}
{% endif %}